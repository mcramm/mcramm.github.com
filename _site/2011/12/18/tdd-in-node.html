<!DOCTYPE html>
<html>
  <head>
    <title>Tdd In Node</title>
    <link href='http://fonts.googleapis.com/css?family=Arvo&v2' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Chivo' rel='stylesheet' type='text/css'>
    <link rel='stylesheet' href='/css/screen.css'></link>
    <link rel='stylesheet' href='/css/highlight.css'></link>
    <link rel='shortcut icon' type='image/ico' href='http://mcramm.com/favicon.png'></link>
  </head>
  <body>
    <div class='header'>
        <a class='header-text' href='/'>mcramm.com</a>
        <div class='navigation'>
            <a href='/'>About</a>
            <a href='/posts.html'>Posts</a>
            <a target='_blank' href='http://feeds.feedburner.com/mcramm'>Feed</a>
        </div>
    </div>
    <div class='content'>
    <h1>Tdd In Node </h1>
    <p>TDD is discipline that I&#8217;ve been trying to master for a while now, and I&#8217;ve been absorbing every blog post, talk, or book I can get my hands on. One thing thats key for me is to have some way to run my tests very quickly. Even better, the tests should run automatically whenever code in application files or tests changes.</p>

<p>In Ruby, I have Guard. It works beautifully and does exactly what I need it to do. I spent the last week struggling to find something similar in NodeJs but didn&#8217;t come up with anything I liked. I found it frustrating, because watching for events on files or directories is something that Node should be good at. In the end I settled on writing a simple Cakefile:</p>
<div class='highlight'><pre><code class='ruby'>    <span class='no'>CoffeeScript</span> <span class='o'>=</span> <span class='nb'>require</span> <span class='s1'>&#39;coffee-script&#39;</span>

    <span class='p'>{</span><span class='nb'>print</span><span class='p'>}</span> <span class='o'>=</span> <span class='nb'>require</span> <span class='s1'>&#39;util&#39;</span>
    <span class='nb'>exec</span> <span class='o'>=</span> <span class='nb'>require</span><span class='p'>(</span><span class='s1'>&#39;child_process&#39;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>exec</span>
    <span class='n'>fs</span> <span class='o'>=</span> <span class='nb'>require</span> <span class='s1'>&#39;fs&#39;</span>

    <span class='c1'># ANSI Terminal Colors</span>
    <span class='n'>green</span> <span class='o'>=</span> <span class='s1'>&#39;\033[0;32m&#39;</span>
    <span class='n'>reset</span> <span class='o'>=</span> <span class='s1'>&#39;\033[0m&#39;</span>
    <span class='n'>red</span> <span class='o'>=</span> <span class='s1'>&#39;\033[0;31m&#39;</span>

    <span class='n'>log</span> <span class='o'>=</span> <span class='p'>(</span><span class='n'>message</span><span class='p'>,</span> <span class='n'>color</span><span class='p'>,</span> <span class='n'>explanation</span><span class='p'>)</span> <span class='o'>-&gt;</span>
        <span class='n'>console</span><span class='o'>.</span><span class='n'>log</span> <span class='n'>color</span> <span class='o'>+</span> <span class='n'>message</span> <span class='o'>+</span> <span class='n'>reset</span> <span class='o'>+</span> <span class='s1'>&#39; &#39;</span> <span class='o'>+</span> <span class='p'>(</span><span class='n'>explanation</span> <span class='ow'>or</span> <span class='s1'>&#39;&#39;</span><span class='p'>)</span>

    <span class='n'>compile</span> <span class='o'>=</span> <span class='p'>(</span><span class='n'>callback</span><span class='p'>)</span> <span class='o'>-&gt;</span>
        <span class='nb'>exec</span> <span class='s2'>&quot;coffee -o js -c lib&quot;</span><span class='p'>,</span> <span class='p'>(</span><span class='n'>error</span><span class='p'>,</span> <span class='n'>stdout</span><span class='p'>,</span> <span class='n'>stderr</span><span class='p'>)</span> <span class='o'>-&gt;</span>
            <span class='k'>if</span> <span class='n'>error</span> <span class='n'>is</span> <span class='n'>null</span>
                <span class='n'>log</span> <span class='s1'>&#39;compiled!&#39;</span><span class='p'>,</span> <span class='n'>green</span>
                <span class='n'>callback?</span><span class='p'>()</span>
            <span class='k'>else</span>
                <span class='n'>log</span> <span class='n'>error</span><span class='p'>,</span> <span class='n'>red</span>

    <span class='nb'>test</span> <span class='o'>=</span> <span class='o'>-&gt;</span>
        <span class='n'>command</span> <span class='o'>=</span> <span class='s1'>&#39;jasmine-node --coffee spec&#39;</span>

        <span class='nb'>exec</span> <span class='n'>command</span><span class='p'>,</span> <span class='p'>(</span><span class='n'>error</span><span class='p'>,</span> <span class='n'>stdout</span><span class='p'>,</span> <span class='n'>stderr</span><span class='p'>)</span> <span class='o'>-&gt;</span>
            <span class='k'>if</span> <span class='n'>error</span> <span class='n'>is</span> <span class='n'>null</span>
                <span class='n'>log</span> <span class='n'>stdout</span><span class='p'>,</span> <span class='n'>green</span>
            <span class='k'>else</span>
                <span class='n'>log</span> <span class='n'>stdout</span><span class='p'>,</span> <span class='n'>red</span>

    <span class='n'>task</span> <span class='s1'>&#39;build&#39;</span><span class='p'>,</span> <span class='s1'>&#39;Compile the coffeescript into javascript&#39;</span><span class='p'>,</span> <span class='o'>-&gt;</span>
        <span class='n'>compile</span><span class='p'>()</span>

    <span class='n'>task</span> <span class='s1'>&#39;test&#39;</span><span class='p'>,</span> <span class='s1'>&#39;Run the tests&#39;</span><span class='p'>,</span> <span class='o'>-&gt;</span>
        <span class='nb'>test</span><span class='p'>()</span>

    <span class='n'>task</span> <span class='s1'>&#39;watch&#39;</span><span class='p'>,</span> <span class='s1'>&#39;Watch for file changes and compile into javascript&#39;</span><span class='p'>,</span> <span class='o'>-&gt;</span>
        <span class='n'>fs</span><span class='o'>.</span><span class='n'>watch</span> <span class='s1'>&#39;spec&#39;</span><span class='p'>,</span> <span class='p'>(</span><span class='n'>event</span><span class='p'>,</span> <span class='n'>filename</span><span class='p'>)</span> <span class='o'>-&gt;</span> <span class='nb'>test</span><span class='p'>()</span>
        <span class='n'>fs</span><span class='o'>.</span><span class='n'>watch</span> <span class='s1'>&#39;lib&#39;</span><span class='p'>,</span> <span class='p'>(</span><span class='n'>event</span><span class='p'>,</span> <span class='n'>filename</span><span class='p'>)</span> <span class='o'>-&gt;</span> <span class='n'>compile</span> <span class='nb'>test</span>

        <span class='n'>compile</span> <span class='nb'>test</span>
</code></pre>
</div>
<p>This file is pretty simple and contains three tasks: build, test and watch. Node has an easy way to watch for file system events on directories through <code>fs.watch &lt;directory&gt;</code>.</p>

<p>I tried a couple of testing libraries, but settled on <a href='https://github.com/mhevery/jasmine-node'>jasmine-node</a> since I&#8217;ve used it before.</p>

<p>Now I can just run <code>cake watch</code> and start writing code. Occasionally I&#8217;ll stop and take a look at the other monitor to make sure everything is green. I used this process and ran through the classic <a href='http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata'>Bowling Game Kata</a>. I also posted <a href='https://github.com/mcramm/node_katas'>the source</a> on GitHub.</p>
</div>
<div class='respond'>
    Want to comment? Send a message to <a href='https://twitter.com/intent/tweet?text=@cramm'>@cramm</a> on Twitter.
</div>


    <div class='footer-wrap'>
        <div class='footer'>
            <div class='copyright'>&copy; 2012 Michael Cramm</div>
        </div>
    </div>
</body>
</html>
