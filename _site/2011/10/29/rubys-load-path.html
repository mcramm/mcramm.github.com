<!DOCTYPE html>
<html>
  <head>
    <title>Ruby's Load Path</title>
    <link href='http://fonts.googleapis.com/css?family=Arvo&v2' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Chivo' rel='stylesheet' type='text/css'>
    <link rel='stylesheet' href='/css/screen.css'></link>
    <link rel='stylesheet' href='/css/highlight.css'></link>
    <link rel='icon' type='image/png' href='https://lh4.googleusercontent.com/-mDxSUIZcgrI/TpnO60oHq7I/AAAAAAAAAtQ/NkYt_vfqQ4g/s73/icon.png'></link>
  </head>
  <body>
    <div class='header'>
        <a class='header-text' href='/'>mcramm.com</a>
            <div class='buttons'>
                <a href='https://github.com/mcramm'><img src='https://lh4.googleusercontent.com/-5_8rnYH_YbA/ToZRB70imlI/AAAAAAAAAr4/0X5KbQ1gWlA/s288/Octocat.png' width='40px'/></a>
                <a href='http://twitter.com/cramm'><img src='https://lh6.googleusercontent.com/-F-Qtu1RTa5s/ToZRCLErIbI/AAAAAAAAAr8/IboN5dcHCJo/s288/twitter_newbird_blue.png' width='40px'/></a>
            </div>
    </div>
    <div class ='sidebar'>
    <div class='navigation'>
        <a href='/'>About</a>
        <a class='current' href='/posts.html'>Posts</a>
        <a target='_blank' href='/atom.xml'>RSS</a>
    </div>
</div>
<div class='content'>
    <h1>Ruby's Load Path </h1>
    <p>One thing that always tripped me up when I first started writing my own gems was how to properly require other files when the files were relative to the current file&#8217;s path. Let&#8217;s say you have your classes laid out like this:</p>
<div class='highlight'><pre><code class='bash'>    app.rb
    lib/
        myclass.rb
        anotherclass.rb
</code></pre>
</div>
<p>How would you require those two files in <code>lib</code>? I quickly became used to doing something like this:</p>
<div class='highlight'><pre><code class='ruby'>    <span class='nb'>require</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>dirname</span><span class='p'>(</span><span class='bp'>__FILE__</span><span class='p'>),</span> <span class='s1'>&#39;lib&#39;</span><span class='p'>,</span> <span class='s1'>&#39;myclass&#39;</span> <span class='p'>)</span>
    <span class='nb'>require</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>dirname</span><span class='p'>(</span><span class='bp'>__FILE__</span><span class='p'>),</span> <span class='s1'>&#39;lib&#39;</span><span class='p'>,</span> <span class='s1'>&#39;anotherclass&#39;</span> <span class='p'>)</span>
</code></pre>
</div>
<p>Which works, but has a lot of duplication. All I really care about is the name of the file I&#8217;m requiring, and that&#8217;s all the way at the end of the line.</p>

<p>In quicker, smaller projects, it was okay since I only ever needed to require one file at a time. On larger projects though, I began to do the following:</p>
<div class='highlight'><pre><code class='ruby'>    <span class='n'>path_to_lib</span> <span class='o'>=</span>  <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>dirname</span><span class='p'>(</span><span class='bp'>__FILE__</span><span class='p'>),</span> <span class='s1'>&#39;lib&#39;</span> <span class='p'>)</span>
    <span class='nb'>require</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span> <span class='n'>path_to_lib</span><span class='p'>,</span> <span class='s1'>&#39;myclass&#39;</span> <span class='p'>)</span>
</code></pre>
</div>
<p>This was better but it still felt like I was doing something unnecessary. Finally one day I was frustrated enough to look into what <code>require</code> actually did. How does Ruby know where to look when requiring a gem? If I want to use the <a href='http://rubydoc.info/gems/typhoeus/0.3.2/frames'>Typhoeus</a> library, I can just say <code>require &#39;typhoeus&#39;</code>; I don&#8217;t need to specify the full path to its location.</p>

<p>Sounds like its time to check out Ruby&#8217;s <a href='http://www.ruby-doc.org/core-1.9.2/Kernel.html#method-i-require'>Kernel</a> module.</p>

<blockquote>
<p>Ruby tries to load the library named <em>string</em>, returning <em>true</em> if successful. If the filename does not resolve to an absolute path, it will be searched for in the directories listed in <code>$:</code>.</p>
</blockquote>

<p>Makes sense. All I should need to do is add the subdirectory I want to require to load to the path that Ruby scans through. Kernel&#8217;s rdoc says that the path(s) are stored in <code>$:</code>. Let&#8217;s see whats in there:</p>
<div class='highlight'><pre><code class='ruby'>    <span class='nb'>p</span> <span class='vg'>$:</span>  <span class='c1'># =&gt; [&quot;/Library/Ruby/Site/1.8&quot;, ... ]</span>
</code></pre>
</div>
<p>Looks like its just an array of paths. I should be able to simply add a path to the end of the array and Ruby <em>should</em> scan that directory when I call <code>require</code>:</p>
<div class='highlight'><pre><code class='ruby'>    <span class='vg'>$:</span><span class='o'>.</span><span class='n'>unshift</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='no'>File</span><span class='o'>.</span><span class='n'>dirname</span><span class='p'>(</span><span class='bp'>__FILE__</span><span class='p'>),</span> <span class='s1'>&#39;..&#39;</span><span class='p'>,</span> <span class='s1'>&#39;lib&#39;</span><span class='p'>)</span>
</code></pre>
</div>
<p>Again, this works, but <code>$:</code> dosen&#8217;t feel intuitive. Some quick googling shows that <code>$LOAD_PATH</code> is an alias for <code>$:</code>:</p>
<div class='highlight'><pre><code class='ruby'>    <span class='vg'>$LOAD_PATH</span><span class='o'>.</span><span class='n'>unshift</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='no'>File</span><span class='o'>.</span><span class='n'>dirname</span><span class='p'>(</span><span class='bp'>__FILE__</span><span class='p'>),</span> <span class='s1'>&#39;..&#39;</span><span class='p'>,</span> <span class='s1'>&#39;lib&#39;</span><span class='p'>)</span>

    <span class='nb'>require</span> <span class='s1'>&#39;myclass&#39;</span>
    <span class='nb'>require</span> <span class='s1'>&#39;anotherclass&#39;</span>
</code></pre>
</div>
<p>Now you can see immediately which file is being required. Plus, if you&#8217;re writing a gem, you only need to do this <em>once</em> in the base class and the same load path will be used in any file beneath it.</p>
</div>

</body>
</html>
