<!DOCTYPE html>
<html>
  <head>
    <title>Composing Functions</title>
    <link href='http://fonts.googleapis.com/css?family=Arvo&v2' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Chivo' rel='stylesheet' type='text/css'>
    <link rel='stylesheet' href='/css/screen.css'></link>
    <link rel='stylesheet' href='/css/highlight.css'></link>
    <link rel='shortcut icon' type='image/ico' href='http://mcramm.com/favicon.png'></link>
  </head>
  <body>
    <div class='header'>
        <a class='header-text' href='/'>mcramm.com</a>
        <div class='navigation'>
            <a href='/'>About</a>
            <a href='/posts.html'>Posts</a>
            <a target='_blank' href='http://feeds.feedburner.com/mcramm'>Feed</a>
        </div>
    </div>
    <div class='content'>
    <h1>Composing Functions </h1>
    <p>Let's look at the different flavors of function composition in Clojure.</p>

<h2 id="comp">Comp</h2>

<p>There is a function in clojure.core called <code>comp</code> that takes a set of functions and returns a function that is a composition of those functions:</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='kd'>defn </span><span class='nv'>doubler</span> <span class='p'>[</span><span class='nv'>x</span><span class='p'>]</span>
      <span class='p'>(</span><span class='nb'>* </span><span class='nv'>x</span> <span class='mi'>2</span><span class='p'>))</span>

    <span class='p'>(</span><span class='kd'>defn </span><span class='nv'>incrementer</span> <span class='p'>[</span><span class='nv'>x</span><span class='p'>]</span>
      <span class='p'>(</span><span class='nb'>+ </span><span class='nv'>x</span> <span class='mi'>1</span><span class='p'>))</span>

    <span class='p'>(</span><span class='k'>def </span><span class='nv'>doubler-and-incrementer</span> <span class='p'>(</span><span class='nb'>comp </span><span class='nv'>incrementer</span> <span class='nv'>doubler</span><span class='p'>))</span>

    <span class='p'>(</span><span class='nb'>map </span><span class='nv'>doubler-and-incrementer</span> <span class='p'>[</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>])</span> <span class='c1'>; =&gt; [3 5 7 9]</span>
</code></pre></div>
<blockquote>
<p><code>clojure.core/inc</code> exists, but I recreate it here to be explicit</p>
</blockquote>

<p>Note that when composing functions with comp, they are applied right to left to their arguments:</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='k'>def </span><span class='nv'>incrementer-and-doubler</span> <span class='p'>(</span><span class='nb'>comp </span><span class='nv'>doubler</span> <span class='nv'>incrementer</span><span class='p'>))</span>

    <span class='p'>(</span><span class='nb'>map </span><span class='nv'>incrementer-and-doubler</span> <span class='p'>[</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>])</span> <span class='c1'>; =&gt; [4 6 8 10]</span>
</code></pre></div>
<h2 id="partial">Partial</h2>

<p>Another function in clojure.core is <code>partial</code> that takes a function and some arguments to that function and returns a new function that will accept the remaining number of arguments. This can be useful when combined with comp and writing a custom reducer:</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='k'>def </span><span class='nv'>incrementer-and-doubler</span> <span class='p'>(</span><span class='nb'>comp </span><span class='p'>(</span><span class='nb'>partial map </span><span class='nv'>doubler</span><span class='p'>)</span>
                                       <span class='p'>(</span><span class='nb'>partial map </span><span class='nv'>incrementer</span><span class='p'>)))</span>

    <span class='p'>(</span><span class='nf'>incrementer-and-doubler</span> <span class='p'>[</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>])</span> <span class='c1'>; =&gt; [4 6 8 10]</span>
</code></pre></div>
<blockquote>
<p>Clojure 1.7 will introduce transducers, which will likely become the idiomatic way of accomplishing this same task.</p>
</blockquote>

<h2 id="threading_macros">Threading Macros</h2>

<p>A more popular method of composition are the thread-first and thread-last macros.</p>

<p>The thread-first macro evaluates the first expression then passes the result into first argument of the next form, and the result of that into the first argument of the next form and so on.</p>

<p>In other words, this:</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='nf'>doubler</span> <span class='p'>(</span><span class='nf'>incrementer</span> <span class='mi'>2</span><span class='p'>))</span>
</code></pre></div>
<p>Is the same as this:</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='nb'>-&gt; </span><span class='mi'>2</span> <span class='nv'>incrementer</span> <span class='nv'>doubler</span><span class='p'>)</span>
</code></pre></div>
<p>Thread-last works the same way, but it passes the result of each expression into the last element of each successive form.</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='nf'>-&gt;&gt;</span> <span class='p'>[</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>]</span>
         <span class='p'>(</span><span class='nb'>map </span><span class='nv'>incrementer</span><span class='p'>)</span>
              <span class='p'>(</span><span class='nb'>map </span><span class='nv'>doubler</span><span class='p'>))</span>
</code></pre></div>
<p>Is the same as:</p>
<div class='highlight'><pre><code class='clojure'>    <span class='p'>(</span><span class='nb'>map </span><span class='nv'>doubler</span> <span class='p'>(</span><span class='nb'>map </span><span class='nv'>incrementer</span> <span class='p'>[</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>]))</span>
</code></pre></div>
</div>
<div class='respond'>
    Want to comment? Send a message to <a href='https://twitter.com/intent/tweet?text=@cramm'>@cramm</a> on Twitter.
</div>


    <div class='footer-wrap'>
        <div class='footer'>
            <div class='copyright'>&copy; 2014 Michael Cramm</div>
        </div>
    </div>
</body>
</html>
