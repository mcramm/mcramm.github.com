<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mcrammm.com</title>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/main.css">
    <link href="http://localhost:1313//index.xml" rel="alternate" type="application/rss+xml" title="mcrammm.com" />
    <meta name="title" content="http://localhost:1313/">
    <link rel="canonical" href="http://localhost:1313/">
    <meta property="og:title" content="mcrammm.com"/>
    <meta property="og:url" content="http://localhost:1313/"/>
    <meta property="og:site_name" content="mcrammm.com">
    <style>
        .container {
            max-width:1155px;
        }

        pre {
            white-space: pre;
            overflow: scroll;
            width:inherit;
            word-wrap: normal;
            word-break: normal;
        }

        article blockquote {
            background-color: whitesmoke;
            font-size: 0.85em;
            border-left: 5px solid #eeeeee;
            margin: 0 0 20px 0;
            padding: 10px 20px;
        }

        article blockquote p {
            font-size: inherit;
            line-height: inherit;
            color: inherit;
            font-weight: inherit;
        }
    </style>
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a href="/" class="home">About</a>
            <a href="/post" class="post">Posts</a>
        </nav>
    </header>
</section>

<article>
    <div class="container">
        <header>
            <div class="meta">
                <time pubdate datetime="2015-07-02" title="2015-07-02">July 02, 2015</time>
            </div>
            <h1 class="title">Datomic Setup</h1>
            <h2 class="subtitle"></h2>
        </header>

        <section>
            

<p>I&rsquo;ve recently been exploring Datomic more seriously and have found myself
jumping through the same hoops as I have in the past <em>just to get things up and
running</em>. I&rsquo;ve also encountered slight deficiencies in the documentation that
I&rsquo;ve had to re-investigate since the exploratory project I created had long
since been deleted.</p>

<p>I&rsquo;m tired of jumping through these same hoops again so I thought I&rsquo;d create a
quick post with some of the basic steps to get setup &amp; using Datomic in an
application.</p>

<h2 id="installing-datomic:68b984354b67329dbeb357734c95ec25">Installing Datomic</h2>

<p>You do not need to install Datomic to get started, you can use the in-memory
database.</p>

<p>Go here: <a href="https://my.datomic.com/downloads/free">https://my.datomic.com/downloads/free</a> and find the latest version.</p>

<p>Then add <code>[com.datomic/datomic-free &quot;&lt;the-latest-version&gt;&quot;]</code> to your Leiningen project.</p>

<hr />

<h2 id="component-setup:68b984354b67329dbeb357734c95ec25">Component Setup</h2>

<p>This is pretty easy, but you should have something like this:</p>

<p><div class="highlight"><pre>    <span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.component.datomic</span>
      <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">com.stuartsierra.component</span> <span class="ss">:as</span> <span class="nv">component</span><span class="p">]</span>
                <span class="p">[</span><span class="nv">datomic.api</span> <span class="ss">:as</span> <span class="nv">datomic</span><span class="p">]))</span>

    <span class="p">(</span><span class="kd">defrecord </span><span class="nv">DatomicComponent</span> <span class="p">[</span><span class="nv">uri</span> <span class="nv">conn</span><span class="p">]</span>
      <span class="nv">component/Lifecycle</span>
      <span class="p">(</span><span class="nf">start</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="ss">:conn</span> <span class="nv">this</span><span class="p">)</span>
          <span class="nv">this</span>
          <span class="p">(</span><span class="nf">do</span>
            <span class="p">(</span><span class="nb">assoc </span><span class="nv">this</span> <span class="ss">:conn</span> <span class="p">(</span><span class="nf">datomic/connect</span> <span class="nv">uri</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nf">stop</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
        <span class="p">(</span><span class="nb">assoc </span><span class="nv">this</span> <span class="ss">:conn</span> <span class="nv">nil</span><span class="p">)))</span>
</pre></div>
</p>

<h2 id="schema:68b984354b67329dbeb357734c95ec25">Schema</h2>

<p><div class="highlight"><pre>    <span class="p">(</span><span class="k">def </span><span class="nv">schema</span>
      <span class="p">(</span><span class="nf">delay</span>
        <span class="p">(</span><span class="nf">read-string</span>
          <span class="p">(</span><span class="nb">slurp </span><span class="p">(</span><span class="nf">io/resource</span> <span class="s">&quot;my_project/schema.edn&quot;</span><span class="p">))))</span>

    <span class="p">(</span><span class="kd">defn </span><span class="nv">create-schema</span> <span class="p">[</span><span class="nv">conn</span><span class="p">]</span>
      <span class="p">(</span><span class="nf">datomic/transact</span> <span class="nv">conn</span> <span class="o">@</span><span class="nv">schema</span><span class="p">))</span>
</pre></div>
</p>

<h2 id="seed-data:68b984354b67329dbeb357734c95ec25">Seed Data</h2>

<p><div class="highlight"><pre>    <span class="p">(</span><span class="k">def </span><span class="nv">seed-data</span>
      <span class="p">(</span><span class="nf">delay</span>
        <span class="p">(</span><span class="nf">read-string</span>
          <span class="p">(</span><span class="nb">slurp </span><span class="p">(</span><span class="nf">io/resource</span> <span class="s">&quot;my_project/seed-data.edn&quot;</span><span class="p">))))</span>

    <span class="p">(</span><span class="kd">defn </span><span class="nv">seed-db</span> <span class="p">[</span><span class="nv">conn</span><span class="p">]</span>
      <span class="p">(</span><span class="nf">datomic/transact</span> <span class="nv">conn</span> <span class="o">@</span><span class="nv">seed-data</span><span class="p">))</span>
</pre></div>
</p>

<h2 id="queries:68b984354b67329dbeb357734c95ec25">Queries</h2>

<p><div class="highlight"><pre>    <span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.accounts</span>
      <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">datomic.api</span> <span class="ss">:as</span> <span class="nv">datomic</span><span class="p">]</span>
                <span class="p">[</span><span class="nv">my-project.component.datomic</span><span class="p">])</span>
      <span class="p">(</span><span class="ss">:import</span> <span class="p">[</span><span class="nv">my_project.component.datomic</span> <span class="nv">DatomicComponent</span><span class="p">]))</span>

    <span class="p">(</span><span class="kd">defprotocol </span><span class="nv">AccountOps</span>
      <span class="p">(</span><span class="nf">all</span> <span class="p">[</span><span class="nv">this</span><span class="p">])</span>
      <span class="p">(</span><span class="nf">by-email</span> <span class="p">[</span><span class="nv">this</span> <span class="nv">email</span><span class="p">]))</span>

    <span class="p">(</span><span class="nf">extend-type</span> <span class="nv">DatomicComponent</span>
      <span class="nv">AccountOps</span>
      <span class="p">(</span><span class="nf">all</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
        <span class="p">(</span><span class="nf">datomic/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="p">[(</span><span class="nf">pull</span> <span class="nv">?account</span> <span class="p">[</span><span class="nb">* </span><span class="p">{</span><span class="ss">:account/email</span> <span class="p">[</span><span class="nv">*</span><span class="p">]}])</span> <span class="nv">...</span><span class="p">]</span>
                     <span class="ss">:where</span> <span class="p">[</span><span class="nv">?account</span> <span class="ss">:account/email</span><span class="p">]]</span>
                   <span class="p">(</span><span class="nf">datomic/db</span> <span class="p">(</span><span class="ss">:conn</span> <span class="nv">this</span><span class="p">))))</span>
      <span class="p">(</span><span class="nf">by-email</span> <span class="p">[</span><span class="nv">this</span> <span class="nv">email</span><span class="p">]</span>
        <span class="p">(</span><span class="nf">datomic/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="p">[(</span><span class="nf">pull</span> <span class="nv">?account</span> <span class="p">[</span><span class="nv">*</span><span class="p">])</span> <span class="nv">...</span><span class="p">]</span>
                     <span class="ss">:in</span> <span class="nv">$</span> <span class="nv">?email</span>
                     <span class="ss">:where</span> <span class="p">[</span><span class="nv">?account</span> <span class="ss">:account/email</span> <span class="nv">?email</span><span class="p">]]</span>
                   <span class="p">(</span><span class="nf">datomic/db</span> <span class="p">(</span><span class="ss">:conn</span> <span class="nv">this</span><span class="p">))</span>
                   <span class="nv">email</span><span class="p">)))</span>
</pre></div>
</p>

            

        </section>

        
    </div>
</article>

<footer class="site-footer">
    <div class="container">
        <nav>
            <a href="/" class="home">About</a>
            <a href="/post" class="post">Posts</a>
        </nav>
        
        <nav class="social">
            
            <a href="https://twitter.com/cramm" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="https://github.com/mcramm" title="Follow on Github" target="_blank"><i class="icon icon-github black"></i></a>
            
            <a href="/index.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
    </div>
</footer>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>







  

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

